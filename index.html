<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Valentine - Intent</title>
  <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@600;700&family=Nunito:wght@700;800&family=Pacifico&display=swap" rel="stylesheet">

  <style>
    :root {
      --hot: #ff4d8d;
      --hot2: #ff85b3;
      --text: #ff3a87;
      --heart-pink: #ff6699; 
      --card: #ffffff;
      --shadow: 0 22px 55px rgba(255, 120, 180, 0.15);
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; margin: 0; overflow: hidden; background-color: #ffedf4; }
    body {
      font-family: 'Nunito', sans-serif;
      background: radial-gradient(1200px 700px at 50% 40%, #ffedf4 0%, #ffd6e7 42%, #ffb8d4 100%);
      display: grid;
      place-items: center;
      position: relative;
    }

    /* --- èƒŒæ™¯ï¼šä»åº•åˆ°é¡¶ï¼Œæ’å®šé€æ˜åº¦ --- */
    .bg-animation { position: fixed; inset: 0; pointer-events: none; z-index: 1; overflow: hidden; }
    .floating-item { position: absolute; user-select: none; will-change: transform; opacity: 0.7; bottom: -10vh; }
    .item-heart { color: var(--heart-pink); filter: drop-shadow(0 0 1px rgba(255, 58, 135, 0.3)); animation: continuousRise linear infinite; }
    .item-env { color: rgba(255, 255, 255, 0.9); filter: drop-shadow(0 0 1.5px rgba(255, 46, 99, 0.2)); animation: continuousRise linear infinite; }

    @keyframes continuousRise {
      0% { transform: translateY(10vh) translateX(0) rotate(0deg); }
      100% { transform: translateY(-120vh) translateX(40px) rotate(360deg); }
    }

    #confetti { position: fixed; inset: 0; pointer-events: none; z-index: 9999; }

    /* å¡ç‰‡ä¸»ä½“ */
    .card {
      position: relative;
      width: min(580px, 92vw);
      height: min(550px, 85vh);
      background: var(--card);
      border-radius: 35px;
      box-shadow: var(--shadow);
      padding: 40px;
      text-align: center;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 10;
      border: 1px solid rgba(255, 255, 255, 0.6);
    }

    /* è¾¹æ¡†è£…é¥°å°çˆ±å¿ƒ */
    .card::before, .card::after { content: 'â¤'; position: absolute; color: var(--hot2); opacity: 0.3; font-size: 18px; pointer-events: none; }
    .card .corner-heart { content: 'â¤'; position: absolute; color: var(--hot2); opacity: 0.3; font-size: 18px; pointer-events: none; }
    .card::before { top: 20px; left: 25px; transform: rotate(-15deg); }
    .card::after { bottom: 20px; right: 25px; transform: rotate(15deg); }
    .heart-tl { top: 20px; right: 25px; transform: rotate(15deg); position: absolute; }
    .heart-bl { bottom: 20px; left: 25px; transform: rotate(-15deg); position: absolute; }

    .hidden { display: none !important; }
    .handFont { font-family: 'Pacifico', cursive; color: var(--text); }
    .nameNormal { font-family: 'Nunito', sans-serif; font-weight: 800; font-size: 50px; color: var(--text); }
    
    .line1-wrap { font-size: 46px; margin: 5px 0; width: 100%; text-align: center; }
    .line2-wrap { max-height: 0; opacity: 0; overflow: hidden; font-size: 46px; transition: all 0.3s ease-out; width: 100%; text-align: center; }
    .line2-wrap.show { max-height: 150px; opacity: 1; margin: 10px 0; }

    .btns { display: flex; gap: 20px; margin-top: 30px; justify-content: center; position: relative; width: 100%; }
    .btn { padding: 16px 40px; border: none; border-radius: 50px; font-family: 'Fredoka', sans-serif; font-weight: 700; font-size: 20px; cursor: pointer; }
    #yes { background: linear-gradient(180deg, var(--hot2), var(--hot)); color: white; animation: heartBeat 1.2s infinite ease-in-out; }
    #no { background: #f3f4f7; color: #555; transition: left 0.2s, top 0.2s; }
    @keyframes heartBeat { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.06); } }

    /* ç»“æœé¡µå­—å¹•å±…ä¸­ */
    #screen2 { display: flex; flex-direction: column; align-items: center; justify-content: space-around; height: 100%; width: 100%; }
    .logo-outer { width: 220px; height: 220px; display: grid; place-items: center; }
    .logo-outer img { width: 100%; height: 100%; object-fit: contain; }
    
    .reveal-text { opacity: 0; transform: translateY(20px); transition: all 0.5s ease-out; width: 100%; text-align: center; }
    .reveal-text.active { opacity: 1; transform: translateY(0); }
    
    .iknew { font-family: 'Pacifico', cursive; font-size: 54px; color: var(--text); margin: 10px 0; }
    .msg { font-size: 19px; color: #444; line-height: 1.5; font-weight: 700; max-width: 420px; font-style: italic; margin: 10px 0; }

    .emoji-row { display: flex; gap: 12px; opacity: 0; transition: opacity 0.5s ease; justify-content: center; width: 100%; }
    .emoji-row.active { opacity: 1; }
    .emoji-row span { font-size: 26px; animation: emojiBounce 1.5s infinite ease-in-out; }
    @keyframes emojiBounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
  </style>
</head>

<body>
  <div class="bg-animation" id="bgLayer"></div>
  <canvas id="confetti"></canvas>

  <div class="card">
    <span class="corner-heart heart-tl">â¤</span>
    <span class="corner-heart heart-bl">â¤</span>

    <div id="screen1">
      <div class="line1-wrap">
        <span class="handFont">Hey </span>
        <span id="typedName" class="nameNormal"></span>
      </div>
      <div class="line2-wrap handFont" id="line2">Will you be my valentine? ğŸ’–</div>
      <div class="btns">
        <button class="btn" id="yes">Yes ğŸ’—</button>
        <button class="btn" id="no">No ğŸ™ˆ</button>
      </div>
      <div id="pleaseWrap" style="margin-top: 30px; font-weight: 800; color: var(--text); font-size: 22px; width: 100%; text-align: center;">
        <span id="pleaseText">Please</span> <span id="pleaseEmoji">ğŸ¥º â¤ï¸</span>
      </div>
    </div>

    <div id="screen2" class="hidden">
      <div class="logo-outer"><img src="./intent.png" alt="Logo" /></div>
      <div class="reveal-text iknew" id="resLine1">I knew it!</div>
      <div class="reveal-text msg" id="resLine2">"No matter where we are, or what language we speak, I'll always find a way to say I love you."</div>
      <div class="emoji-row" id="resEmoji">
        <span>ğŸ’</span><span>ğŸ’–</span><span>ğŸ’</span><span>â¤ï¸</span>
      </div>
    </div>
  </div>

  <script>
    // âœ… 1) ä» URL è¯» n= å¹¶æ ¼å¼åŒ–æˆâ€œäººåæ ·å­â€
    function formatName(input) {
      if (!input) return "";
      // URLSearchParams ä¸ä¼šæŠŠ + è‡ªåŠ¨å½“ç©ºæ ¼ï¼Œæ‰€ä»¥æ‰‹åŠ¨å¤„ç†
      let s = input.replace(/\+/g, " ").trim();

      // é˜²æ­¢æ¶æï¼šé™åˆ¶é•¿åº¦ï¼ˆéœ€è¦æ›´é•¿å°±æ”¹è¿™ä¸ªæ•°å­—ï¼‰
      s = s.slice(0, 18);

      // åªå…è®¸å¸¸è§äººåå­—ç¬¦ï¼šå­—æ¯æ•°å­— ç©ºæ ¼ ' -
      // ï¼ˆå¦‚æœä½ è¦æ”¯æŒä¸­æ–‡åå­—ï¼Œå‘Šè¯‰æˆ‘ï¼Œæˆ‘æŠŠè¿™è¡Œæ¢æˆæ”¯æŒä¸­æ–‡çš„ç‰ˆæœ¬ï¼‰
      s = s.replace(/[^a-zA-Z0-9 '\-]/g, "");

      // æ¯ä¸ªå•è¯é¦–å­—æ¯å¤§å†™
      s = s
        .split(/\s+/)
        .filter(Boolean)
        .map(w => w.charAt(0).toUpperCase() + w.slice(1).toLowerCase())
        .join(" ");

      return s;
    }

    const rawName = new URLSearchParams(location.search).get("n");
    const urlName = formatName(rawName) || "Yesha";

    const sleep = (ms) => new Promise(resolve => setTimeout(resolve, ms));

    const canvas = document.getElementById('confetti');
    const ctx = canvas.getContext('2d');
    function resize() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
    window.addEventListener('resize', resize);
    resize();

    function launchConfetti(x, y) {
      const particles = [];
      const colors = ["#ff4d8d", "#ff85b3", "#ffffff", "#fff9f5", "#ff2e63", "#ffc1d6"];
      for (let i = 0; i < 350; i++) {
        const angle = Math.random() * Math.PI * 2;
        const speed = Math.random() * 18 + 6;
        particles.push({
          x, y,
          vx: Math.cos(angle) * speed,
          vy: Math.sin(angle) * speed - 5,
          size: Math.random() * 6 + 2.5,
          color: colors[Math.floor(Math.random() * colors.length)],
          opacity: 1, friction: 0.95, gravity: 0.35, spin: Math.random() * 0.2 - 0.1
        });
      }
      function animate() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        let stillActive = false;
        particles.forEach(p => {
          p.vx *= p.friction; p.vy *= p.friction; p.vy += p.gravity;
          p.x += p.vx; p.y += p.vy; p.opacity -= 0.008;
          if (p.opacity > 0) {
            stillActive = true;
            ctx.globalAlpha = p.opacity;
            ctx.fillStyle = p.color;
            ctx.beginPath();
            ctx.save();
            ctx.translate(p.x, p.y);
            ctx.rotate(p.opacity * 10 * p.spin);
            ctx.fillRect(-p.size/2, -p.size/2, p.size, p.size);
            ctx.restore();
          }
        });
        if (stillActive) requestAnimationFrame(animate);
      }
      animate();
    }

    async function init() {
      const el = document.getElementById("typedName");
      el.textContent = "";
      for (const char of urlName) {
        el.textContent += char;
        await sleep(char === " " ? 60 : 100);
      }
      document.getElementById("line2").classList.add("show");
    }
    window.onload = () => { init(); createBackground(); };

    const yesBtn = document.getElementById('yes');
    const noBtn = document.getElementById('no');
    const pleaseText = document.getElementById('pleaseText');
    const pleaseEmoji = document.getElementById('pleaseEmoji');

    const lines = [
        { text: "Think again!", emoji: "ğŸ˜­ â¤ï¸" },
        { text: "That was a misclick", emoji: "ğŸ¥º âœ¨" },
        { text: "Oops, wrong button", emoji: "ğŸ¤« ğŸ€" },
        { text: "One more try?", emoji: "ğŸ­ ğŸ¥°" },
        { text: "You don't mean that", emoji: "ğŸ˜¢ ğŸ­" }
    ];

    function handleNo() {
      const randomLine = lines[Math.floor(Math.random() * lines.length)];
      pleaseText.textContent = randomLine.text;
      pleaseEmoji.textContent = randomLine.emoji;
      noBtn.style.position = 'fixed';
      noBtn.style.left = Math.random() * (window.innerWidth - 150) + 'px';
      noBtn.style.top = Math.random() * (window.innerHeight - 50) + 'px';
    }
    noBtn.onmouseover = noBtn.onclick = handleNo;

    yesBtn.onclick = async () => {
      const rect = yesBtn.getBoundingClientRect();
      // âœ… çƒŸèŠ±ä»¥ Yes æŒ‰é’®ä¸­å¿ƒä¸ºçˆ†ç‚¹ï¼ˆä½ ä¹‹å‰æƒ³è¦çš„â€œå±…ä¸­çˆ†â€ï¼‰
      launchConfetti(rect.left + rect.width / 2, rect.top + rect.height / 2);

      document.getElementById('screen1').classList.add('hidden');
      document.getElementById('screen2').classList.remove('hidden');
      await sleep(100);
      document.getElementById('resLine1').classList.add('active');
      await sleep(250);
      document.getElementById('resLine2').classList.add('active');
      await sleep(150);
      document.getElementById('resEmoji').classList.add('active');
    };

    function createBackground() {
      const container = document.getElementById('bgLayer');
      const items = ['â¤', 'â™¥', 'â£', 'âœ‰', 'ğŸ’Œ'];
      for (let i = 0; i < 75; i++) {
        const span = document.createElement('span');
        const isEnv = i % 3 === 0;
        span.className = 'floating-item ' + (isEnv ? 'item-env' : 'item-heart');
        span.textContent = items[Math.floor(Math.random() * items.length)];
        const duration = Math.random() * 5 + 8;
        const delay = Math.random() * 15;
        span.style.cssText = `left: ${Math.random() * 100}vw; font-size: ${Math.random() * 15 + 15}px; animation-duration: ${duration}s; animation-delay: ${delay}s;`;
        container.appendChild(span);
      }
    }
  </script>
</body>
</html>
